name: üöÄ Deploy Laravel via FTP

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: üéâ Deploy to production
    runs-on: ubuntu-latest
    environment: production
    concurrency:
      group: master-deploy
      cancel-in-progress: true

    steps:
      # 1Ô∏è‚É£ Checkout repository
      - name: üì¶ Checkout code
        uses: actions/checkout@v2

      # 2Ô∏è‚É£ Deploy via FTP (stabil, no 550 errors)
      - name: üöÄ FTP Deploy
        uses: SamKirkland/FTP-Deploy-Action@4.4.0
        with:
          server: ${{ secrets.FTP_SERVER_PRODUCTION }}
          username: ${{ secrets.FTP_USERNAME_PRODUCTION }}
          password: ${{ secrets.FTP_PASSWORD_PRODUCTION }}
          port: 21
          protocol: ftp
          local-dir: ./                  # semua isi repo
          server-dir: ./laravel/         # sesuaikan path Laravel di server
          dry-run: false
          allow-delete: false            # jangan hapus file/folder lama ‚Üí hindari error 550
          continue-on-error: true        # skip file/folder yang hilang

      # 3Ô∏è‚É£ (Opsional) Clear Laravel cached views via URL
      # Pastikan ada route/artisan command di server yang bisa dipanggil
      - name: ‚ö° Clear Laravel cached views
        run: |
          curl -s -X GET https://${{ secrets.SERVER_URL }}/artisan-view-clear || true
